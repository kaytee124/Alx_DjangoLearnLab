{% extends 'blog/base.html' %}

{% block title %}All Posts{% endblock %}

{% block content %}
<div class="container">
    {% if user.is_authenticated %}
    <nav class="top-navigation" style="margin-bottom: 20px; padding: 10px; background-color: #f5f5f5; border-radius: 5px;">
        <ul style="list-style: none; display: flex; gap: 15px; margin: 0; padding: 0; flex-wrap: wrap; align-items: center;">
            <li><a href="{% url 'post_create' %}" class="btn btn-primary" style="text-decoration: none; padding: 8px 15px; background-color: #007bff; color: white; border-radius: 3px;">Create Post</a></li>
            <li><a href="{% url 'profile' %}" class="btn btn-secondary" style="text-decoration: none; padding: 8px 15px; background-color: #6c757d; color: white; border-radius: 3px;">Profile</a></li>
            <li><a href="{% url 'logout' %}" class="btn btn-danger" style="text-decoration: none; padding: 8px 15px; background-color: #dc3545; color: white; border-radius: 3px;">Logout</a></li>
            <li style="margin-left: auto;">
                <form method="get" action="{% url 'search' %}" style="display: flex; gap: 5px;">
                    <input type="text" name="q" placeholder="Search posts..." 
                           value="{{ search_query }}" 
                           style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 3px; min-width: 200px;">
                    <button type="submit" style="padding: 6px 15px; background-color: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer;">Search</button>
                </form>
            </li>
        </ul>
    </nav>
    {% endif %}
    
    {% if is_search %}
        <h2>Search Results{% if search_query %} for "{{ search_query }}"{% endif %}</h2>
        <p style="color: #666; margin-bottom: 20px;">
            Found {{ posts|length }} post{{ posts|length|pluralize }}.
            <a href="{% url 'post_list' %}">View all posts</a>
        </p>
    {% elif is_tag_filter %}
        <h2>Posts tagged with "{{ tag_name }}"</h2>
        <p style="color: #666; margin-bottom: 20px;">
            Found {{ posts|length }} post{{ posts|length|pluralize }}.
            <a href="{% url 'post_list' %}">View all posts</a>
        </p>
    {% else %}
        <h2>All Posts</h2>
    {% endif %}

    {% if posts %}
        <ul class="post-list">
            {% for post in posts %}
            <li class="post-item" style="background-color: #f9f9f9; padding: 15px; margin-bottom: 15px; border-radius: 5px;">
                <h3><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></h3>
                <p>{{ post.content|truncatechars:100 }}</p>
                <p><small>By {{ post.author.username }} on {{ post.published_date|date:"M d, Y H:i" }}</small></p>
                {% if post.tags.all %}
                <div class="post-tags" style="margin-top: 10px;">
                    {% for tag in post.tags.all %}
                        <a href="{% url 'posts_by_tag' tag.name %}" style="display: inline-block; background-color: #007bff; color: white; padding: 3px 8px; border-radius: 3px; margin: 2px 5px 2px 0; font-size: 11px; text-decoration: none;">{{ tag.name }}</a>
                    {% endfor %}
                </div>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    {% else %}
        {% if is_search %}
            <div style="text-align: center; padding: 40px; background-color: #f9f9f9; border-radius: 5px;">
                <p style="font-size: 18px; color: #666;">No posts found matching "{{ search_query }}".</p>
                <p style="margin-top: 10px;">
                    <a href="{% url 'post_list' %}" class="btn btn-primary">View All Posts</a>
                </p>
            </div>
        {% elif is_tag_filter %}
            <div style="text-align: center; padding: 40px; background-color: #f9f9f9; border-radius: 5px;">
                <p style="font-size: 18px; color: #666;">No posts found with tag "{{ tag_name }}".</p>
                <p style="margin-top: 10px;">
                    <a href="{% url 'post_list' %}" class="btn btn-primary">View All Posts</a>
                </p>
            </div>
        {% else %}
            <p>No posts available.</p>
        {% endif %}
    {% endif %}
</div>
{% endblock %}